# 1- Start with 0 packetloss rate
# 2- Run packet capture with tcpdump on port 53 on the ifb0 interface, 
#    save the logs to tcpdump_log_00.pcap (last 2 digits of the file is the packetloss rate)

$ sudo tcpdump -w tcpdump_log_00.pcap -nnn -i ifb0 "src port 53"

# 3- Run the python script (sendQueriesToResolvers.py) to start sending DNS queries

$ python3 ./sendQueriesToResolvers.py

# 4- When the script ends, stop packet capture of tcpdump by pressing CTRL+C
# 5- Simulate 10% packetloss rate on the ifb0 interface

$ sudo tc qdisc add dev ifb0 root netem loss 10% 

# 6- Run packet capture with tcpdump on port 53 on the ifb0 interface, 
#    save the logs to tcpdump_log_10.pcap 

$ sudo tcpdump -w tcpdump_log_10.pcap -nnn -i ifb0 "src port 53"

# 7- Run the python script (sendQueriesToResolvers.py) to start sending DNS queries

$ python3 ./sendQueriesToResolvers.py

# 8- When the script ends, stop packet capture of tcpdump by pressing CTRL+C
# 9- Disable the packetloss simulation

sudo tc qdisc del dev ifb0 root
sudo tc -s qdisc ls dev ifb0


# 10- Simulate 20% packetloss rate on the ifb0 interface

$ sudo tc qdisc add dev ifb0 root netem loss 20% 

# 11- Run packet capture with tcpdump on port 53 on the ifb0 interface, 
#    save the logs to tcpdump_log_20.pcap 

$ sudo tcpdump -w tcpdump_log_20.pcap -nnn -i ifb0 "src port 53"

# 12- Run the python script (sendQueriesToResolvers.py) to start sending DNS queries

$ python3 ./sendQueriesToResolvers.py

# 13- When the script ends, stop packet capture of tcpdump by pressing CTRL+C
# 14- Disable the packetloss simulation

sudo tc qdisc del dev ifb0 root
sudo tc -s qdisc ls dev ifb0


# 15- Simulate 30% packetloss rate on the ifb0 interface

$ sudo tc qdisc add dev ifb0 root netem loss 30% 

# 16- Run packet capture with tcpdump on port 53 on the ifb0 interface, 
#    save the logs to tcpdump_log_30.pcap 

$ sudo tcpdump -w tcpdump_log_30.pcap -nnn -i ifb0 "src port 53"

# 17- Run the python script (sendQueriesToResolvers.py) to start sending DNS queries

$ python3 ./sendQueriesToResolvers.py

# 18- When the script ends, stop packet capture of tcpdump by pressing CTRL+C
# 19- Disable the packetloss simulation

sudo tc qdisc del dev ifb0 root
sudo tc -s qdisc ls dev ifb0


# 20- Simulate 40% packetloss rate on the ifb0 interface

$ sudo tc qdisc add dev ifb0 root netem loss 40% 

# 21- Run packet capture with tcpdump on port 53 on the ifb0 interface, 
#    save the logs to tcpdump_log_40.pcap 

$ sudo tcpdump -w tcpdump_log_40.pcap -nnn -i ifb0 "src port 53"

# 22- Run the python script (sendQueriesToResolvers.py) to start sending DNS queries

$ python3 ./sendQueriesToResolvers.py

# 23- When the script ends, stop packet capture of tcpdump by pressing CTRL+C
# 24- Disable the packetloss simulation

sudo tc qdisc del dev ifb0 root
sudo tc -s qdisc ls dev ifb0










# Filter each resolver communication by applying filters on wireshark

# ?- Open all the saved log files one by one in wireshark, 
     export the file as JSON (file name: wireshark0PL.json "1PL" stands for 10% packet loss) 
# ?- Run the plotter script (createPlots.py) that uses the json files to create a box plot and a bar plot 
   that compares the latencies/failure rates regarding packetloss.